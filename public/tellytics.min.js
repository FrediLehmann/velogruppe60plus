var __awaiter=this&&this.__awaiter||function(e,o,r,s){return new(r=r||Promise)(function(n,t){function a(e){try{c(s.next(e))}catch(e){t(e)}}function i(e){try{c(s.throw(e))}catch(e){t(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,i)}c((s=s.apply(e,o||[])).next())})};let events=[],projectId,previousUrl=location.href,acceptedTracking=!1;function getCookie(e){e=null!=(e=RegExp(e+"=[^;]+").exec(document.cookie))?e:"";return decodeURIComponent(e.toString().replace(/^[^=]+./,""))}function trackEvent(e){events.push(Object.assign(Object.assign({},e),{timestamp:Date.now()})),window.requestIdleCallback?window.requestIdleCallback(saveEvents,{timeout:2e3}):setTimeout(saveEvents,2e3)}function saveEvents(){return __awaiter(this,void 0,void 0,function*(){if(acceptedTracking){var e=events;if(events=[],0!==e.length)try{yield fetch("https://tellytics.vercel.app/api/ingress/events?projectId="+projectId,{method:"POST",credentials:"omit",keepalive:!0,body:JSON.stringify(e.map(({name:e,timestamp:t,metadata:n})=>Object.assign(Object.assign({l:location.href,ts:t,e:e},location.host.includes(document.referrer)?{}:{r:document.referrer}),{metadata:n})))})}catch(e){console.error(e)}}})}function checkIfPathHasChanged(e){return e.pathname===new URL(previousUrl).pathname}function onPageChange(e){null==e||checkIfPathHasChanged("string"==typeof e?new URL(e,location.origin):e)||trackEvent({name:"pageview"})}function acceptTracking(e){document.cookie=`tellytics=${acceptedTracking};Max-Age=0;`,acceptedTracking=e;var t=new Date;t.setFullYear(t.getFullYear()+10),document.cookie=`tellytics=${e?"1":"0"};expires=${t.toUTCString()};Path=/;SameSite=None;Secure`,e&&saveEvents()}(()=>{if(("undefined"!=typeof window||void 0!==window.document)&&void 0===window.TLL){window.TLL=!0,window.Tellytics={events:events,trackEvent:trackEvent,acceptTracking:acceptTracking};var e="1"===getCookie("tellytics"),t=(e&&null!=(t=window.Tellytics)&&t.acceptTracking(!0),new CustomEvent("tellyticsLoaded",{detail:{acceptedTracking:e}}));document.dispatchEvent(t),projectId=null==(e=document.querySelector("script[data-tellytics]"))?void 0:e.getAttribute("data-tellytics"),trackEvent({name:"pageview"});const n=history.pushState.bind(history);history.pushState=function(...e){n(...e),onPageChange(e[2]),previousUrl=location.href},window.addEventListener("popstate",function(){onPageChange(location.href),previousUrl=location.href})}})();